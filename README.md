# STM32 四轴飞行器无人机项目

本项目是一个基于STM32微控制器的四轴飞行器无人机控制系统。该项目实现了基本的飞行控制功能，包括姿态解算、PID控制、遥控接收、电机控制等核心功能。

## 项目概述

这是一个使用STM32F1系列微控制器开发的四轴飞行器飞控系统。系统通过MPU6050传感器获取飞行器的姿态信息，使用NRF24L01模块接收遥控器指令，通过串级PID算法实现飞行控制，并通过PWM信号控制四个电机的转速以实现稳定飞行。

## 硬件组成

- **主控芯片**: STM32F1系列微控制器
- **姿态传感器**: MPU6050（六轴陀螺仪+加速度计）
- **无线通信**: NRF24L01 2.4GHz无线模块
- **电机驱动**: PWM控制无刷电机
- **USB通信**: 支持与上位机（如匿名上位机）通信调参

## 软件架构

```
quadcopter-drone/
├── Core/                 # STM32 HAL库核心文件
├── Drivers/              # STM32驱动程序
├── Middlewares/          # 中间件（USB库）
├── USB_DEVICE/           # USB设备配置
├── USER/
│   ├── Application/      # 应用层代码（控制算法、任务调度等）
│   ├── Hardware/         # 硬件驱动（MPU6050、电机、NRF24L01等）
│   ├── Header/           # 全局头文件
│   ├── Math/             # 数学库（PID、卡尔曼滤波等）
│   └── System/           # 系统功能（延时、FLASH操作等）
```

## 核心功能

### 1. 姿态解算
- 使用MPU6050六轴传感器获取原始数据
- 通过卡尔曼滤波和一阶低通滤波进行数据融合
- 实现角度（pitch, roll, yaw）的实时计算

### 2. PID控制
- 实现串级PID控制算法
- 外环控制角度，内环控制角速度
- 支持通过上位机实时调节PID参数

### 3. 无线遥控
- 使用NRF24L01模块接收遥控器指令
- 支持油门、偏航、横滚、俯仰四个通道控制

### 4. 电机控制
- PWM信号控制四个无刷电机
- 根据PID输出分配各电机转速
- 实现飞行器的基本飞行动作

### 5. 上位机通信
- 通过USB HID与匿名上位机通信
- 实时上传飞行数据
- 支持在线调参和数据记录

## 主要模块说明

### MPU6050模块
- 实现传感器初始化和数据读取
- 使用DMA提高数据读取效率
- 集成卡尔曼滤波算法提高数据准确性

### PID控制模块
- 实现串级PID控制（角度环+角速度环）
- 支持PID参数在线调节
- 包含紧急保护机制

### 电机控制模块
- PWM信号生成和控制
- 电机转速分配算法
- 安全保护机制

### NRF24L01遥控模块
- 无线遥控信号接收
- 数据包解析和处理

### 匿名上位机通信模块
- USB HID通信协议
- 实时数据上传和参数下发

## 开发环境

- **IDE**: Keil MDK-ARM
- **调试工具**: J-Link
- **辅助工具**: 匿名上位机（调参和数据可视化）

## 使用说明

1. 硬件连接：
   - 连接MPU6050到I2C1接口
   - 连接NRF24L01到SPI2接口
   - 连接电机驱动到PWM输出口（TIM2）

2. 编译和下载：
   - 使用Keil MDK打开项目
   - 编译并下载到STM32芯片

3. 调试和调参：
   - 连接USB到电脑
   - 打开匿名上位机软件
   - 进行PID参数调节和飞行测试

## 注意事项

1. 首次使用时需要进行传感器校准
2. 飞行前请确保螺旋桨安装正确
3. 在安全环境下进行飞行测试
4. 定期检查电池电量和设备连接

## 项目特点

- 基于STM32 HAL库开发，代码结构清晰
- 采用模块化设计，便于功能扩展
- 集成多种滤波算法，提高飞行稳定性
- 支持上位机调参，方便调试优化
- 实现完整的飞行控制算法

## 扩展方向

1. 增加气压计实现定高飞行
2. 集成GPS模块实现定位和返航功能
3. 添加光流传感器实现定点悬停
4. 开发手机APP进行遥控和参数调节
5. 实现自动航线飞行功能

## 贡献

本项目为开源项目，欢迎提出问题和改进建议。

## 许可证

本项目基于MIT许可证发布。